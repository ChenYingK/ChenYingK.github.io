<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/cat-logo.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cat-logo.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cat-logo.jpg">
  <link rel="mask-icon" href="/images/cat-logo.jpg" color="#222">






  
  <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;example.com&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Pisces&quot;,&quot;version&quot;:&quot;8.4.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta property="og:type" content="website">
<meta property="og:title" content="ykproton">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="ykproton">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="chenyk">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:true,&quot;isPost&quot;:false,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:&quot;&quot;,&quot;permalink&quot;:&quot;&quot;,&quot;path&quot;:&quot;index.html&quot;,&quot;title&quot;:&quot;&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>ykproton</title>
  




  <noscript>
    
  </noscript>
<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css');loadCss('https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ykproton</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">chenyk</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">50</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ykproton" title="GitHub → https://github.com/ykproton" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/9355.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/9355.html" class="post-title-link" itemprop="url">Nginx</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-21 21:32:44 / 修改时间：21:34:58" itemprop="dateCreated datePublished" datetime="2021-06-21T21:32:44+08:00">2021-06-21</time>
    </span>

  
    <span id="/posts/9355.html" class="post-meta-item leancloud_visitors" data-flag-title="Nginx" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><ol>
<li><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><p><em>Nginx</em> (engine x) 是一个高性能的<strong>HTTP</strong>和<strong>反向代理</strong>web服务器.</p>
</li>
<li><h5 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理:"></a>反向代理:</h5><ul>
<li><h6 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理:"></a>正向代理:</h6><p>代理服务器为客户端做代理,主要为客户端服务,可以隐藏客户端信息</p>
<p><img src="/Nginx/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86.png" alt="img"></p>
</li>
<li><h6 id="反向代理-1"><a href="#反向代理-1" class="headerlink" title="反向代理:"></a>反向代理:</h6><p>主要是为服务端代理,所以叫做反向代理,可以隐藏服务端信息</p>
<img src="Nginx/反向代理.png" alt="img" style="zoom:67%;"></li>
</ul>
</li>
<li><h5 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡:"></a>负载均衡:</h5><p>缓解服务器压力,和提升容错能力</p>
<ol>
<li><h6 id="单点负载均衡"><a href="#单点负载均衡" class="headerlink" title="单点负载均衡"></a>单点负载均衡</h6></li>
</ol>
<img src="Nginx/v2-6aa2607e04cc9d2f0d448f9fa80b2ae2_720w.jpg" alt="img" style="zoom:50%;">

<ol>
<li><h6 id="负载均衡集群"><a href="#负载均衡集群" class="headerlink" title="负载均衡集群"></a>负载均衡集群</h6><p>避免因为单个负载均衡节点故障,导致不可用</p>
<img src="Nginx/负载均衡集群.jpg" alt="preview" style="zoom:50%;"></li>
<li><h6 id="负载均衡算法"><a href="#负载均衡算法" class="headerlink" title="负载均衡算法"></a>负载均衡算法</h6><ol>
<li><strong>Round Robin（轮询）：</strong>为第一个请求选择列表中的第一个服务器，然后按顺序向下移动列表直到结尾，然后循环。</li>
<li><strong>LeastConnections（最小连接）：</strong>优先选择连接数最少的服务器，在普遍会话较长的情况下推荐使用。</li>
<li><strong>Source：</strong>根据请求源的 IP 的散列（hash）来选择要转发的服务器。这种方式可以一定程度上保证特定用户能连接到相同的服务器。</li>
</ol>
</li>
</ol>
</li>
<li><h5 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h5><p>动态请求与静态资源放在不同的服务器上</p>
</li>
<li><h5 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h5><ol>
<li><p>添加源:<code>sudo rpm -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</code></p>
</li>
<li><p>使用<code>yum search nginx</code>查看,源是否添加成功</p>
<p>安装Nginx</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y nginx</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>设置自动运行</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nginx.service</span><br><span class="line">sudo systemctl enable nginx.service</span><br></pre></td></tr></tbody></table></figure>

<p>若想使用外部主机连接上虚拟机,访问 IP:80 ，需要关闭虚拟机的防火墙：</p>
<p>centOS7关闭防火墙命令：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">      &nbsp;systemctl stop firewalld.service</span><br></pre></td></tr></tbody></table></figure>

<p>或者配置防火墙开放端口:</p>
<ul>
<li><p>查看开放的端口号:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-all </span><br></pre></td></tr></tbody></table></figure></li>
<li><p>设置开放的端口号:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd  --add-service=http -permanent</span><br><span class="line">sudo firewall-cmd --add-port=80/tcp --permanent</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>重启防火墙:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd -reload</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ol>
</li>
<li><h5 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h5><p>使用nginx命令式,必须进入nginx目录: 比如 /user/sbin/nginx</p>
<ol>
<li><p>查看版本号</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -v</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>启动nginx</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>关闭nginx</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s stop</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>重新加载配置:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
<li><h5 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h5><p>配置文件: 在安装位置找到配置文件,nginx.conf</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">user  nobody;</span></span><br><span class="line">worker_processes  1;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log  notice;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">error_log  logs/error.log  info;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events {</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http {</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '</span><br><span class="line">    #                  '$status $body_bytes_sent "$http_referer" '</span><br><span class="line">    #                  '"$http_user_agent" "$http_x_forwarded_for"';</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">    server {</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / {</span><br><span class="line">            root   html;</span><br><span class="line">            index  index.html index.htm;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        #error_page  404              /404.html;</span><br><span class="line"></span><br><span class="line">        # redirect server error pages to the static page /50x.html</span><br><span class="line">        #</span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html {</span><br><span class="line">            root   html;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ {</span><br><span class="line">        #    proxy_pass   http://127.0.0.1;</span><br><span class="line">        #}</span><br><span class="line"></span><br><span class="line">        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br><span class="line">        #</span><br><span class="line">        #location ~ \.php$ {</span><br><span class="line">        #    root           html;</span><br><span class="line">        #    fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        #    fastcgi_index  index.php;</span><br><span class="line">        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br><span class="line">        #    include        fastcgi_params;</span><br><span class="line">        #}</span><br><span class="line"></span><br><span class="line">        # deny access to .htaccess files, if Apache's document root</span><br><span class="line">        # concurs with nginx's one</span><br><span class="line">        #</span><br><span class="line">        #location ~ /\.ht {</span><br><span class="line">        #    deny  all;</span><br><span class="line">        #}</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server {</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / {</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    }</span><br><span class="line">    #}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server {</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / {</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    }</span><br><span class="line">    #}</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>配置文件分为三个部分:</p>
<ol>
<li><p>全局块:</p>
<p>从配置文件开始到event 块之间的内容,主要设置一些影响nginx服务器整体运行的配置指令.比如并发数,log位置,pid</p>
</li>
<li><p>event 块</p>
<p> 主要影响Nginx服务器与用户的网络连接.</p>
<p>worker_connections 支持的最大连接数.</p>
</li>
<li><p>http 块</p>
<p>配置最频繁的部分,代理,缓存,日志定义,以及第三方配置都在这部分</p>
<p>注意:http 块也包括 http全局块,server块</p>
<ol>
<li><p>http 全局块 </p>
<p>包括文件引入,MIME-TYPE定义,日志自定义,连接超时时间,单链接请求数上限</p>
</li>
<li><p>server 块</p>
<p>与虚拟主机有密切关系.虚拟主机从用户看,是和独立的硬件注意是完全一样的,该技术是为了节省硬件成本.</p>
<p>每个http块可以包含多个server块,每一个server块就相当于一个虚拟主机.</p>
<p>每一个server块也分为全局server块,以及可以同事包含多个location 块</p>
<ul>
<li><p>全局server块:</p>
<p>配置虚拟主机的监听配置和本虚拟主机的名称或者IP配置</p>
</li>
<li><p>location 块</p>
<p>主要作用是基于Nginx服务器接收到的请求字符串(server_name/uri-string),对虚拟主机名称之外的字符串进行匹配,对特定的请求进行处理.地址定向,数据缓存和应答控制等功能,还有许多第三方模块的配置也在这里进行.</p>
</li>
</ul>
</li>
</ol>
</li>
</ol>
</li>
<li><h5 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h5><ol>
<li><h6 id="反向代理-2"><a href="#反向代理-2" class="headerlink" title="反向代理"></a>反向代理</h6><p>效果: 将发送的Nginx的请求,直接转发给tomcat.访问Nginx的端口,即可访问tomcat的8080端口</p>
<p>在Nginx配置文件中修改或者增加:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / {</span><br><span class="line">  root html;</span><br><span class="line"><span class="meta">  #</span><span class="bash">主要配置proxy_pass</span></span><br><span class="line">  proxy_pass http://127.0.0.1:8080/examples/;</span><br><span class="line">  index index.html index.html;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="根据路径的反向代理"><a href="#根据路径的反向代理" class="headerlink" title="根据路径的反向代理"></a>根据路径的反向代理</h6><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">server{</span><br><span class="line"><span class="meta">#</span><span class="bash">监听端口</span></span><br><span class="line">	listen 9001;</span><br><span class="line">	server_name xxxName;</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">	#</span><span class="bash">如果路径是/edu/开头,则进行如下服务</span></span><br><span class="line">	location ~ /edu/ {</span><br><span class="line">		proxy_pass http://127.0.0.1:8080;</span><br><span class="line">	}</span><br><span class="line"><span class="meta">	</span></span><br><span class="line"><span class="meta">	#</span><span class="bash">如果路径是/vod/开头,则进行如下服务</span></span><br><span class="line">	location ~ /vod/ {</span><br><span class="line">		proxy_pass http://127.0.0.1:8081;</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>location 参数说明</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">location [ = | ~ | ~* | ^~ ] uri {</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><p>= : 用于不含正则表达式的uri前,要求请求祖父穿与 uri 严格匹配,如果匹配成功,就停止继续向下搜索,并立即处理请求.</p>
</li>
<li><p>~ : 用于表示uri包含正则表达式,并且区分大小写</p>
</li>
<li><p>~* :表示用于uri包含正则表达式,不区分大小写</p>
</li>
<li><p>^~ : 用于不包含正则表达式的uri前,要求Nginx服务器找到标志uri和请求字符串匹配度最高的 location后,立即使用此location处理请求,而不再使用location中的正则 uri 和请求字符串做匹配:</p>
<p>注意: 如果uri包含正则表达式,则必须要有~ 或者 ~* 标志.</p>
</li>
</ol>
</li>
<li><h6 id="负载均衡-1"><a href="#负载均衡-1" class="headerlink" title="负载均衡"></a>负载均衡</h6><p>配置文件:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver {</span><br><span class="line">    server 192.168.0.104:9002 weight=1; # 服务器1</span><br><span class="line">    server 192.168.0.104:9003 weight=1; # 服务器2</span><br><span class="line">    ip_hash;   #负载均衡策略</span><br><span class="line">}</span><br><span class="line">      </span><br><span class="line">server {</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root         /usr/share/nginx/html;</span><br><span class="line">      </span><br><span class="line">    # Load configuration files for the default server block.</span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">    location /  {</span><br><span class="line">            proxy_pass http://myserver; # 导向自定义的myserver</span><br><span class="line">    }</span><br><span class="line">      </span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    location = /404.html {</span><br><span class="line">    }</span><br><span class="line">      </span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html {</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">      </span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><p>分配策略:</p>
<ol>
<li><p>轮询(默认)</p>
<p>每个请求按时间顺序,注意分配到不同的后端服务器,如果后端服务器down掉,则自动剔除.</p>
</li>
<li><p>weight</p>
<p>weight代表权重,默认为1,权重越高,被分配的客户端越多.用于后端服务器性能不均的情况.</p>
</li>
<li><p>ip_hash</p>
<p>每个请求按照ip的hash结果进行分配,这样每个访客固定访问一个后端服务器,可以解决session问题.</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver {</span><br><span class="line">  server 192.168.0.104:9002 weight=1;</span><br><span class="line">  server 192.168.0.104:9003 weight=1;</span><br><span class="line">  ip_hash; </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
<li><p>fair(第三方)</p>
<p>按照后端服务器响应时间来分配请求,响应时间越短的优先分配.</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver {</span><br><span class="line">  server 192.168.0.104:9002 weight=1;</span><br><span class="line">  server 192.168.0.104:9003 weight=1;</span><br><span class="line">  fair; </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
</ul>
<ol start="4">
<li><p>动态资源静态资源分离:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line">    root         /usr/share/nginx/html;</span><br><span class="line">         </span><br><span class="line">    # Load configuration files for the default server block.</span><br><span class="line">    include /etc/nginx/default.d/*.conf;</span><br><span class="line">         </span><br><span class="line"><span class="meta">#</span><span class="bash">静态资源路径, root会作为根路径,实际访问路径是/home/static</span></span><br><span class="line">    location /static/ {</span><br><span class="line">            root /home/;</span><br><span class="line">    }</span><br><span class="line">         </span><br><span class="line">    location /  {</span><br><span class="line">            proxy_pass http://myserver;</span><br><span class="line">    }</span><br><span class="line">         </span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    location = /404.html {</span><br><span class="line">    }</span><br><span class="line">         </span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html {</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line">         </span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/49381.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/49381.html" class="post-title-link" itemprop="url">6. Spring Boot CLI</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:39:00 / 修改时间：12:46:25" itemprop="dateCreated datePublished" datetime="2021-06-10T12:39:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/49381.html" class="post-meta-item leancloud_visitors" data-flag-title="6. Spring Boot CLI" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="Spring-Boot-CLI"><a href="#Spring-Boot-CLI" class="headerlink" title="Spring Boot CLI"></a>Spring Boot CLI</h4><p>Spring Boot CLI 是一个命令行工具,如果想快速开发 Spring 应用程序,可以使用它.它允许运行 Groovy 脚本,这意味着拥有类似 Java 的语法,而无需太多样板代码.还可以引导一个新项目或为它编写自己的命令.</p>
<ol>
<li><h5 id="安装-CLI-Installing-the-CLI"><a href="#安装-CLI-Installing-the-CLI" class="headerlink" title="安装 CLI(Installing the CLI)"></a>安装 CLI(Installing the CLI)</h5><p>可以使用 SDKMAN(SDK 管理器)手动安装 Spring Boot CLI(Command-Line Interface)或使用 Homebrew 或 MacPorts(如果是 OSX 用户).</p>
</li>
<li><h5 id="使用-CLI-Using-the-CLI"><a href="#使用-CLI-Using-the-CLI" class="headerlink" title="使用 CLI(Using the CLI)"></a>使用 CLI(Using the CLI)</h5><p>安装 CLI 后,可以在命令行中输入 <code>spring</code> 并按 Enter 来运行它.如果不带任何参数运行 <code>spring</code>,将显示帮助屏幕,如下所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring</span></span><br><span class="line">usage: spring [--help] [--version]</span><br><span class="line">       &lt;command&gt; [&lt;args&gt;]</span><br><span class="line"></span><br><span class="line">Available commands are:</span><br><span class="line"></span><br><span class="line">  run [options] &lt;files&gt; [--] [args]</span><br><span class="line">    Run a spring groovy script</span><br><span class="line"></span><br><span class="line">  _... more command help is shown here_</span><br></pre></td></tr></tbody></table></figure>

<p>可以输入 <code>spring help</code> 以获取有关任何受支持命令的更多详细信息,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring <span class="built_in">help</span> run</span></span><br><span class="line">spring run - Run a spring groovy script</span><br><span class="line"></span><br><span class="line">usage: spring run [options] &lt;files&gt; [--] [args]</span><br><span class="line"></span><br><span class="line">Option                     Description</span><br><span class="line">------                     -----------</span><br><span class="line">--autoconfigure [Boolean]  Add autoconfigure compiler</span><br><span class="line">                             transformations (default: true)</span><br><span class="line">--classpath, -cp           Additional classpath entries</span><br><span class="line">--no-guess-dependencies    Do not attempt to guess dependencies</span><br><span class="line">--no-guess-imports         Do not attempt to guess imports</span><br><span class="line">-q, --quiet                Quiet logging</span><br><span class="line">-v, --verbose              Verbose logging of dependency</span><br><span class="line">                             resolution</span><br><span class="line">--watch                    Watch the specified file for changes</span><br></pre></td></tr></tbody></table></figure>

<p><code>version</code> 命令提供了一种快速检查使用的 Spring Boot 版本的方法,如下所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring version</span></span><br><span class="line">Spring CLI v2.5.0</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><h6 id="使用-CLI-运行应用程序-Running-Applications-with-the-CLI"><a href="#使用-CLI-运行应用程序-Running-Applications-with-the-CLI" class="headerlink" title="使用 CLI 运行应用程序(Running Applications with the CLI)"></a>使用 CLI 运行应用程序(Running Applications with the CLI)</h6><p>可以使用 <code>run</code> 命令编译和运行 Groovy 源代码.Spring Boot CLI 是完全独立的,因此不需要任何外部 Groovy 安装.</p>
<p>以下示例显示了一个用 Groovy 编写的”hello world”Web 应用程序:</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebApplication</span> {</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</span><br><span class="line">    String home() {</span><br><span class="line">        <span class="string">"Hello World!"</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>要编译和运行应用程序,请输入以下命令:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run hello.groovy</span></span><br></pre></td></tr></tbody></table></figure>

<p>要将命令行参数传递给应用程序,请使用<code>--</code> 将命令与”spring”命令参数分开,如下例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run hello.groovy -- --server.port=9000</span></span><br></pre></td></tr></tbody></table></figure>

<p>要设置 JVM 命令行参数,可以使用 <code>JAVA_OPTS</code> 环境变量,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> JAVA_OPTS=-Xmx1024m spring run hello.groovy</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意:</p>
<p>​    在 Microsoft Windows 上设置 <code>JAVA_OPTS</code> 时,请确保引用整个指令,例如设置”<code>JAVA_OPTS=-Xms256m -Xmx2048m</code>“. 这样做可确保将值正确传递给进程.</p>
</blockquote>
<ol>
<li><h6 id="推导出的”抓取”依赖关系-Deduced-“grab”-Dependencies"><a href="#推导出的”抓取”依赖关系-Deduced-“grab”-Dependencies" class="headerlink" title="推导出的”抓取”依赖关系(Deduced “grab” Dependencies)"></a>推导出的”抓取”依赖关系(Deduced “grab” Dependencies)</h6><p>标准 Groovy 包括一个 <code>@Grab</code> 注解,它允许声明对第三方库的依赖关系.这项有用的技术让 Groovy 以与 Maven 或 Gradle 相同的方式下载 jar,但不需要使用构建工具.</p>
<p>Spring Boot 进一步扩展了这项技术,并尝试根据代码推断出要”抓取”哪些库.例如,由于之前显示的 Web 应用程序代码使用了 <code>@RestController</code> 注解,因此 Spring Boot 会抓取”Tomcat”和”Spring MVC”.</p>
<p>以下项目用作”抓取提示”:</p>
<table>
<thead>
<tr>
<th>Items</th>
<th>Grabs</th>
</tr>
</thead>
<tbody><tr>
<td><code>JdbcTemplate</code>, <code>NamedParameterJdbcTemplate</code>, <code>DataSource</code></td>
<td>JDBC Application.</td>
</tr>
<tr>
<td><code>@EnableJms</code></td>
<td>JMS Application.</td>
</tr>
<tr>
<td><code>@EnableCaching</code></td>
<td>Caching abstraction.</td>
</tr>
<tr>
<td><code>@Test</code></td>
<td>JUnit.</td>
</tr>
<tr>
<td><code>@EnableRabbit</code></td>
<td>RabbitMQ.</td>
</tr>
<tr>
<td>extends <code>Specification</code></td>
<td>Spock test.</td>
</tr>
<tr>
<td><code>@EnableBatchProcessing</code></td>
<td>Spring Batch.</td>
</tr>
<tr>
<td><code>@MessageEndpoint</code> <code>@EnableIntegration</code></td>
<td>Spring Integration.</td>
</tr>
<tr>
<td><code>@Controller</code> <code>@RestController</code> <code>@EnableWebMvc</code></td>
<td>Spring MVC + Embedded Tomcat.</td>
</tr>
<tr>
<td><code>@EnableWebSecurity</code></td>
<td>Spring Security.</td>
</tr>
<tr>
<td><code>@EnableTransactionManagement</code></td>
<td>Spring Transaction Management.</td>
</tr>
</tbody></table>
<blockquote>
<p>建议:</p>
<p>​    参见 <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/v2.5.0/spring-boot-project/spring-boot-cli/src/main/java/org"><code>CompilerAutoConfiguration</code></a> 的子类,在 Spring Boot CLI 源代码中,以准确了解如何应用自定义.</p>
</blockquote>
</li>
<li><h6 id="推导出的”抓取”坐标-Deduced-“grab”-Coordinates"><a href="#推导出的”抓取”坐标-Deduced-“grab”-Coordinates" class="headerlink" title="推导出的”抓取”坐标(Deduced “grab” Coordinates)"></a>推导出的”抓取”坐标(Deduced “grab” Coordinates)</h6><p>Spring Boot 扩展了 Groovy 的标准 <code>@Grab</code> 支持,允许指定没有组或版本的依赖项(例如,<code>@Grab('freemarker')</code>).这样做会参考 Spring Boot 的默认依赖项元数据来推断artifact的组和版本.</p>
<blockquote>
<p>注意:</p>
<p>​    默认元数据与使用的 CLI 版本相关联. 它仅在迁移到到新版本的 CLI 时才会更改,可以控制依赖项的版本何时可能更改.</p>
</blockquote>
</li>
<li><h6 id="默认导入语句-Default-Import-Statements"><a href="#默认导入语句-Default-Import-Statements" class="headerlink" title="默认导入语句(Default Import Statements)"></a>默认导入语句(Default Import Statements)</h6><p>为了帮助减少 Groovy 代码的大小,自动包含了几个<code>import</code>语句.请注意前面的示例如何引用 <code>@Component</code>,<code>@RestController</code> 和 <code>@RequestMapping</code> 而无需使用完全限定名称或<code>import</code>语句.</p>
<blockquote>
<p>建议:</p>
<p>​    许多 Spring 注解可以在不使用 <code>import</code> 语句的情况下工作. 在添加导入之前尝试运行应用的方式来查看失败的内容.</p>
</blockquote>
</li>
<li><h6 id="自动Main方法-Automatic-Main-Method"><a href="#自动Main方法-Automatic-Main-Method" class="headerlink" title="自动Main方法(Automatic Main Method)"></a>自动Main方法(Automatic Main Method)</h6><p>与等效的 Java 应用程序不同,不需要在 Groovy 脚本中包含 <code>public static void main(String[] args)</code> 方法. <code>SpringApplication</code> 是自动创建的,编译的代码作为源代码.</p>
</li>
<li><h6 id="自定义依赖管理-Custom-Dependency-Management"><a href="#自定义依赖管理-Custom-Dependency-Management" class="headerlink" title="自定义依赖管理(Custom Dependency Management)"></a>自定义依赖管理(Custom Dependency Management)</h6><p>默认情况下,CLI 在解析 <code>@Grab</code> 依赖项时使用 <code>spring-boot-dependencies</code> 中声明的依赖项管理.用来覆盖默认依赖管理的其他依赖管理,可以使用<code>@DependencyManagementBom</code> 注解实现.注解的值应指定一个或多个 Maven BOM 的坐标 (<code>groupId:artifactId:version</code>).</p>
<p>例如,考虑以下声明:</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DependencyManagementBom</span>(<span class="string">"com.example.custom-bom:1.0.0"</span>)</span><br></pre></td></tr></tbody></table></figure>

<p>前面的声明在 <code>com/example/custom-versions/1.0.0/</code> 下的 Maven 存储库中选择 <code>custom-bom-1.0.0.pom</code>.</p>
<p>当指定多个 BOM 时,它们将按照声明顺序应用,如以下示例所示:</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DependencyManagementBom</span>([    <span class="string">"com.example.custom-bom:1.0.0"</span>,    <span class="string">"com.example.another-bom:1.0.0"</span>])</span><br></pre></td></tr></tbody></table></figure>

<p>前面的例子表明 <code>another-bom</code> 中的依赖管理覆盖了 <code>custom-bom</code> 中的依赖管理.</p>
<p>可以在任何可以使用<code>@Grab</code> 的地方使用<code>@DependencyManagementBom</code>. 但是,为了确保依赖项管理的顺序一致,最多可以在应用程序中使用 <code>@DependencyManagementBom</code> 一次.</p>
</li>
</ol>
</li>
<li><h6 id="具有多个源文件的应用程序-Applications-with-Multiple-Source-Files"><a href="#具有多个源文件的应用程序-Applications-with-Multiple-Source-Files" class="headerlink" title="具有多个源文件的应用程序(Applications with Multiple Source Files)"></a>具有多个源文件的应用程序(Applications with Multiple Source Files)</h6><p>可以对所有接受文件输入的命令使用”shell globbing”.这样做可以使用单个目录中的多个文件,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring run *.groovy</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="打包应用程序-Packaging-Your-Application"><a href="#打包应用程序-Packaging-Your-Application" class="headerlink" title="打包应用程序(Packaging Your Application)"></a>打包应用程序(Packaging Your Application)</h6><p>可以使用 <code>jar</code> 命令将应用打包成一个自包含的可执行 jar 文件,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring jar my-app.jar *.groovy</span></span><br></pre></td></tr></tbody></table></figure>

<p>生成的 jar 包含通过编译应用程序生成的类以及应用程序的所有依赖项,以便可以使用 <code>java -jar </code>运行它.jar 文件还包含来自应用程序类路径的条目. 可以使用 <code>--include</code> 和 <code>--exclude</code> 添加和删除 jar 的显式路径.两者都以逗号分隔,并且都接受”+”和”-“形式的前缀,以表示它们应该从默认值中删除.</p>
<p>默认包含的如下:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public/**, resources/**, static/**, templates/**, META-INF/**, *</span><br></pre></td></tr></tbody></table></figure>

<p>默认排除如下:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.*, repository/**, build/**, target/**, **/*.jar, **/*.groovy</span><br></pre></td></tr></tbody></table></figure>

<p>在命令行中输入 <code>spring help jar</code> 以获取更多信息.</p>
</li>
<li><h6 id="初始化一个新项目-Initialize-a-New-Project"><a href="#初始化一个新项目-Initialize-a-New-Project" class="headerlink" title="初始化一个新项目(Initialize a New Project)"></a>初始化一个新项目(Initialize a New Project)</h6><p><code>init</code> 命令允许使用 <code>start.spring.io</code> 创建一个新项目,而无需离开 shell,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring init --dependencies=web,data-jpa my-projectUsing service at https://start.spring.ioProject extracted to <span class="string">'/Users/developer/example/my-project'</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>前面的示例使用基于 Maven 的项目创建了一个 <code>my-project</code> 目录,该项目使用 <code>spring-boot-starter-web</code> 和 <code>spring-boot-starter-data-jpa</code>..可以使用 <code>--list</code> 标志位列出服务的功能,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring init --list=======================================Capabilities of https://start.spring.io=======================================Available dependencies:-----------------------actuator - Actuator: Production ready features to <span class="built_in">help</span> you monitor and manage your application...web - Web: Support <span class="keyword">for</span> full-stack web development, including Tomcat and spring-webmvcwebsocket - Websocket: Support <span class="keyword">for</span> WebSocket developmentws - WS: Support <span class="keyword">for</span> Spring Web ServicesAvailable project types:------------------------gradle-build -  Gradle Config [format:build, build:gradle]gradle-project -  Gradle Project [format:project, build:gradle]maven-build -  Maven POM [format:build, build:maven]maven-project -  Maven Project [format:project, build:maven] (default)...</span></span><br></pre></td></tr></tbody></table></figure>

<p><code>init</code> 命令支持许多选项. 有关更多详细信息,请参阅帮助输出. 例如,以下命令创建一个使用 Java 8 和 <code>war</code> 打包的 Gradle 项目:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring init --build=gradle --java-version=1.8 --dependencies=websocket --packaging=war sample-app.zipUsing service at https://start.spring.ioContent saved to <span class="string">'sample-app.zip'</span></span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="使用嵌入式-Shell-Using-the-Embedded-Shell"><a href="#使用嵌入式-Shell-Using-the-Embedded-Shell" class="headerlink" title="使用嵌入式 Shell(Using the Embedded Shell)"></a>使用嵌入式 Shell(Using the Embedded Shell)</h6><p>Spring Boot 包含用于 BASH 和 zsh shell 的命令行完整脚本.如果不使用其中任何一个 shell(可能您是 Windows 用户),可以使用 <code>shell</code> 命令启动一个集成的 shell,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring shellSpring Boot (v2.5.0)Hit TAB to complete. Type \<span class="string">'help'</span> and hit RETURN <span class="keyword">for</span> <span class="built_in">help</span>, and \<span class="string">'exit'</span> to quit.</span></span><br></pre></td></tr></tbody></table></figure>

<p>从嵌入式 shell 内部,可以直接运行其他命令:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> versionSpring CLI v2.5.0</span></span><br></pre></td></tr></tbody></table></figure>

<p>嵌入式shell支持 ANSI 颜色输出以及<code>tab</code>补全.如果需要运行本机命令,可以使用 <code>!</code> 前缀. 要退出嵌入式 shell,请按 <code>ctrl-c</code>.</p>
</li>
<li><h6 id="向-CLI-添加扩展-Adding-Extensions-to-the-CLI"><a href="#向-CLI-添加扩展-Adding-Extensions-to-the-CLI" class="headerlink" title="向 CLI 添加扩展(Adding Extensions to the CLI)"></a>向 CLI 添加扩展(Adding Extensions to the CLI)</h6><p>可以使用 <code>install</code> 命令向 CLI 添加扩展.该命令采用 <code>group:artifact:version</code> 格式的一组或多组artifact坐标,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring install com.example:spring-boot-cli-extension:1.0.0.RELEASE</span></span><br></pre></td></tr></tbody></table></figure>

<p>除了安装提供的坐标标识的artifact之外,还安装了所有artifact的依赖项.要卸载依赖项,使用<code>uninstall</code>命令. 与 <code>install</code> 命令一样,它采用 <code>group:artifact:version</code> 格式的一组或多组artifact坐标,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring uninstall com.example:spring-boot-cli-extension:1.0.0.RELEASE</span></span><br></pre></td></tr></tbody></table></figure>

<p>它会卸载提供的坐标及其依赖项标识的artifact.</p>
<p>要卸载所有其他依赖项,可以使用 <code>--all</code> 选项,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> spring uninstall --all</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
<li><h5 id="使用-Groovy-Beans-DSL-开发应用程序-Developing-Applications-with-the-Groovy-Beans-DSL"><a href="#使用-Groovy-Beans-DSL-开发应用程序-Developing-Applications-with-the-Groovy-Beans-DSL" class="headerlink" title="使用 Groovy Beans DSL 开发应用程序(Developing Applications with the Groovy Beans DSL)"></a>使用 Groovy Beans DSL 开发应用程序(Developing Applications with the Groovy Beans DSL)</h5><p>Spring Framework 4.0 原生支持 <code>beans{}</code> “DSL”(从 Grails 借来),可以使用相同的格式将 bean 定义嵌入到 Groovy 应用脚本中.这有时是包含中间件声明等外部功能的好方法,如以下示例所示:</p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="literal">false</span>)<span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> {</span>    <span class="meta">@Autowired</span>    SharedService service    <span class="meta">@Override</span>    <span class="keyword">void</span> run(String... args) {        println service.message    }}<span class="keyword">import</span> my.company.SharedServicebeans {    service(SharedService) {        message = <span class="string">"Hello World"</span>    }}</span><br></pre></td></tr></tbody></table></figure>

<p>可以将类声明与 <code>beans{}</code> 混合在同一个文件中,只要它们保持在顶层,或者,如果愿意,可以将 beans DSL 放在单独的文件中.</p>
</li>
<li><h5 id="使用-settings-xml-配置-CLI-Configuring-the-CLI-with-settings-xml"><a href="#使用-settings-xml-配置-CLI-Configuring-the-CLI-with-settings-xml" class="headerlink" title="使用 settings.xml 配置 CLI (Configuring the CLI with settings.xml)"></a>使用 settings.xml 配置 CLI (Configuring the CLI with settings.xml)</h5><p>Spring Boot CLI 使用 Maven 的依赖解析引擎 Aether 来解析依赖.CLI 使用 <code>~/.m2/settings.xml</code> 中的 Maven 配置来配置 Aether.CLI 遵循以下配置设置:</p>
<ul>
<li>Offline</li>
<li>Mirrors</li>
<li>Servers</li>
<li>Proxies</li>
<li>Profiles<ul>
<li>Activation</li>
<li>Repositories</li>
</ul>
</li>
<li>Active profiles</li>
</ul>
</li>
</ol>
<p>`</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/13348.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/13348.html" class="post-title-link" itemprop="url">7. Build Tool Plugins</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:39:00 / 修改时间：12:45:52" itemprop="dateCreated datePublished" datetime="2021-06-10T12:39:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/13348.html" class="post-meta-item leancloud_visitors" data-flag-title="7. Build Tool Plugins" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="构建工具插件-Build-Tool-Plugins"><a href="#构建工具插件-Build-Tool-Plugins" class="headerlink" title="构建工具插件(Build Tool Plugins)"></a>构建工具插件(Build Tool Plugins)</h4><p>Spring Boot 为 Maven 和 Gradle 提供了构建工具插件.这些插件提供了多种功能,包括可执行 jar 的打包.本节提供了有关这两个插件的更多详细信息,并在需要扩展不受支持的构建系统时提供一些帮助.</p>
<ol>
<li><h5 id="Spring-Boot-Maven-插件-Spring-Boot-Maven-Plugin"><a href="#Spring-Boot-Maven-插件-Spring-Boot-Maven-Plugin" class="headerlink" title="Spring Boot Maven 插件(Spring Boot Maven Plugin)"></a>Spring Boot Maven 插件(Spring Boot Maven Plugin)</h5><p>Spring Boot Maven 插件在 Maven 中提供 Spring Boot 支持,可以打包可执行的 jar 或 war 文件并”就地”运行应用程序. 要使用它,必须使用 Maven 3.2(或更高版本).</p>
<p>请参阅插件的文档以了解更多信息:</p>
<ul>
<li>参考 (<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/maven-plugin/reference/htmlsingle/">HTML</a> 和 [PDF](<a target="_blank" rel="noopener" href="https://docs.spring.io/">https://docs.spring.io</a> /spring-boot/docs/2.5.0/maven-plugin/reference/pdf/spring-boot-maven-plugin-reference.pdf))</li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/maven-plugin/api/">API</a></li>
</ul>
</li>
<li><h5 id="Spring-Boot-AntLib-模块-Spring-Boot-AntLib-Module"><a href="#Spring-Boot-AntLib-模块-Spring-Boot-AntLib-Module" class="headerlink" title="Spring Boot AntLib 模块(Spring Boot AntLib Module)"></a>Spring Boot AntLib 模块(Spring Boot AntLib Module)</h5><p>Spring Boot AntLib 模块为 Apache Ant 提供基本的 Spring Boot 支持. 可以使用该模块创建可执行的 jar.要使用该模块,需要在 <code>build.xml</code> 中声明一个额外的 <code>spring-boot</code> 命名空间,如以下示例所示:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:ivy</span>=<span class="string">"antlib:org.apache.ivy.ant"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:spring-boot</span>=<span class="string">"antlib:org.springframework.boot.ant"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">"myapp"</span> <span class="attr">default</span>=<span class="string">"build"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>需要记住使用 <code>-lib</code> 选项启动 Ant,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ant -lib &lt;directory containing spring-boot-antlib-2.5.0.jar&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="Spring-Boot-AntLib-模块-Spring-Boot-AntLib-Module-1"><a href="#Spring-Boot-AntLib-模块-Spring-Boot-AntLib-Module-1" class="headerlink" title="Spring Boot AntLib 模块(Spring Boot AntLib Module)"></a>Spring Boot AntLib 模块(Spring Boot AntLib Module)</h6><p>Spring Boot AntLib 模块为 Apache Ant 提供基本的 Spring Boot 支持.可以使用该模块创建可执行的 jar. 要使用该模块,需要在 <code>build.xml</code> 中声明一个额外的 <code>spring-boot </code>命名空间,如以下示例所示:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns:ivy</span>=<span class="string">"antlib:org.apache.ivy.ant"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:spring-boot</span>=<span class="string">"antlib:org.springframework.boot.ant"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">name</span>=<span class="string">"myapp"</span> <span class="attr">default</span>=<span class="string">"build"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>需要记住使用 <code>-lib</code> 选项启动 Ant,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ant -lib &lt;directory containing spring-boot-antlib-2.5.0.jar&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<ol>
<li><h5 id="Spring-Boot-Ant-任务-Spring-Boot-Ant-Tasks"><a href="#Spring-Boot-Ant-任务-Spring-Boot-Ant-Tasks" class="headerlink" title="Spring Boot Ant 任务(Spring Boot Ant Tasks)"></a>Spring Boot Ant 任务(Spring Boot Ant Tasks)</h5><p>声明 <code>spring-boot-antlib</code> 命名空间后,可以使用以下附加任务:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/reference/html/build-tool-plugins.html#build-tool-plugins.antlib.tasks.exejar">Using the “exejar” Task</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/reference/html/build-tool-plugins.html#build-tool-plugins.antlib.findmainclass">Using the “findmainclass” Task</a></li>
</ul>
<ol>
<li><h6 id="使用”exejar”任务-Using-the-“exejar”-Task"><a href="#使用”exejar”任务-Using-the-“exejar”-Task" class="headerlink" title="使用”exejar”任务(Using the “exejar” Task)"></a>使用”exejar”任务(Using the “exejar” Task)</h6><p>可以使用 <code>exejar</code> 任务来创建 Spring Boot 可执行 jar. 任务支持以下属性:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td><code>destfile</code></td>
<td>要创建的目标 jar 文件</td>
<td>Yes</td>
</tr>
<tr>
<td><code>classes</code></td>
<td>Java类文件的根目录</td>
<td>Yes</td>
</tr>
<tr>
<td><code>start-class</code></td>
<td>要运行的主要应用程序类</td>
<td>No <em>(默认是找到的第一个声明 <code>main</code> 方法的类)</em></td>
</tr>
</tbody></table>
<p>以下嵌套元素可用于任务:</p>
<table>
<thead>
<tr>
<th>Element</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>resources</code></td>
<td>一个或多个 <a target="_blank" rel="noopener" href="https://ant.apache.org/manual/Types/resources.html#collection">资源集合</a> 描述一组 [资源](<a target="_blank" rel="noopener" href="https://ant.apache.org/manual/Types/">https://ant.apache.org/manual/Types/</a> resources.html) 应该添加到创建的 jar 文件的内容中.</td>
</tr>
<tr>
<td><code>lib</code></td>
<td>一个或多个 <a target="_blank" rel="noopener" href="https://ant.apache.org/manual/Types/resources.html#collection">Resource Collections</a> 应该添加到组成应用程序运行时依赖类路径的一组 jar 库中.</td>
</tr>
</tbody></table>
</li>
<li><h6 id="例子-Examples"><a href="#例子-Examples" class="headerlink" title="例子(Examples)"></a>例子(Examples)</h6><p>本节展示了 Ant 任务的两个示例.</p>
<p><em>Specify start-class</em></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">spring-boot:exejar</span> <span class="attr">destfile</span>=<span class="string">"target/my-application.jar"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">classes</span>=<span class="string">"target/classes"</span> <span class="attr">start-class</span>=<span class="string">"com.example.MyApplication"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"src/main/resources"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lib</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"lib"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">lib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">spring-boot:exejar</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><em>Detect start-class</em></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">exejar</span> <span class="attr">destfile</span>=<span class="string">"target/my-application.jar"</span> <span class="attr">classes</span>=<span class="string">"target/classes"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">lib</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fileset</span> <span class="attr">dir</span>=<span class="string">"lib"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">lib</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">exejar</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
<li><h6 id="使用”findmainclass”任务-Using-the-“findmainclass”-Task"><a href="#使用”findmainclass”任务-Using-the-“findmainclass”-Task" class="headerlink" title="使用”findmainclass”任务(Using the “findmainclass” Task)"></a>使用”findmainclass”任务(Using the “findmainclass” Task)</h6><p><code>exejar</code> 在内部使用 <code>findmainclass</code> 任务来定位声明 main 的类. 如有必要,还可以直接在构建中使用此任务. 支持以下属性:</p>
<table>
<thead>
<tr>
<th>Attribute</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody><tr>
<td><code>classesroot</code></td>
<td>Java类文件的根目录</td>
<td>Yes <em>(unless <code>mainclass</code> is specified)</em></td>
</tr>
<tr>
<td><code>mainclass</code></td>
<td>可用于短路<code>main</code>类搜索</td>
<td>No</td>
</tr>
<tr>
<td><code>property</code></td>
<td>应使用结果设置的 Ant 属性</td>
<td>No <em>(result will be logged if unspecified)</em></td>
</tr>
</tbody></table>
<ol>
<li><h6 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h6><p>本节包含三个使用 <code>findmainclass</code> 的示例.</p>
<p><em>Find and log</em></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">findmainclass</span> <span class="attr">classesroot</span>=<span class="string">"target/classes"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><em>Find and set</em></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">findmainclass</span> <span class="attr">classesroot</span>=<span class="string">"target/classes"</span> <span class="attr">property</span>=<span class="string">"main-class"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><em>Override and set</em></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">findmainclass</span> <span class="attr">mainclass</span>=<span class="string">"com.example.MainClass"</span> <span class="attr">property</span>=<span class="string">"main-class"</span> /&gt;</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
</ol>
</li>
<li><h6 id="支持其他构建系统"><a href="#支持其他构建系统" class="headerlink" title="支持其他构建系统"></a>支持其他构建系统</h6><p>如果想使用 Maven,Gradle 或 Ant 以外的构建工具,可能需要开发自己的插件.可执行jar需要遵循特定的格式,某些条目需要以未压缩的形式写入.</p>
<p>Spring Boot Maven 和 Gradle 插件都使用 <code>spring-boot-loader-tools</code> 来实际生成 jar. 如果需要,可以直接使用这个库.</p>
<ol>
<li><h6 id="重新打包文档-Repackaging-Archives"><a href="#重新打包文档-Repackaging-Archives" class="headerlink" title="重新打包文档(Repackaging Archives)"></a>重新打包文档(Repackaging Archives)</h6><p>要重新打包现有存档以使其成为独立的可执行存档,请使用 <code>org.springframework.boot.loader.tools.Repackager</code>.Repackager 类采用单个构造函数参数,该参数引用现有的 jar 或 war 存档. 使用两种可用的 <code>repackage()</code> 方法之一替换原始文件或写入新目标.在重新打包程序运行之前,还可以在重新打包程序上配置各种设置.</p>
</li>
<li><h6 id="嵌套库-Nested-Libraries"><a href="#嵌套库-Nested-Libraries" class="headerlink" title="嵌套库(Nested Libraries)"></a>嵌套库(Nested Libraries)</h6><p>重新打包存档时,可以使用 <code>org.springframework.boot.loader.tools.Libraries</code> 接口来包含对依赖文件的引用.在这里不提供库的任何具体实现,因为它们通常是特定于构建系统的.</p>
<p>如果存档已包含库,则可以使用 <code>Libraries.NONE</code>.</p>
</li>
<li><h6 id="寻找主类-Finding-a-Main-Class"><a href="#寻找主类-Finding-a-Main-Class" class="headerlink" title="寻找主类(Finding a Main Class)"></a>寻找主类(Finding a Main Class)</h6><p>如果不使用 <code>Repackager.setMainClass()</code> 指定主类,则重新打包程序使用 ASM 读取类文件并尝试使用 <code>public static void main(String[] args)</code> 方法找到合适的类.如果找到多个候选项,则会引发异常.</p>
</li>
<li><h6 id="重新打包实现的示例-Example-Repackage-Implementation"><a href="#重新打包实现的示例-Example-Repackage-Implementation" class="headerlink" title="重新打包实现的示例(Example Repackage Implementation)"></a>重新打包实现的示例(Example Repackage Implementation)</h6><p>以下示例显示了典型的重新打包实现:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBuildTool</span> </span>{    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{        File sourceJarFile = ...        Repackager repackager = <span class="keyword">new</span> Repackager(sourceJarFile);        repackager.setBackupSource(<span class="keyword">false</span>);        repackager.repackage(<span class="keyword">this</span>::getLibraries);    }    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getLibraries</span><span class="params">(LibraryCallback callback)</span> <span class="keyword">throws</span> IOException </span>{        <span class="comment">// Build system specific implementation, callback for each dependency        for (File nestedJar : getCompileScopeJars()) {            callback.library(new Library(nestedJar, LibraryScope.COMPILE));        }        // ...    }    private List&lt;File&gt; getCompileScopeJars() {        return ...    }}</span></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/40038.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/40038.html" class="post-title-link" itemprop="url">5.3 Deploy:  安装 Spring Boot 应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:38:00 / 修改时间：13:03:48" itemprop="dateCreated datePublished" datetime="2021-06-10T12:38:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/40038.html" class="post-meta-item leancloud_visitors" data-flag-title="5.3 Deploy:  安装 Spring Boot 应用" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="3">
<li><h5 id="安装-Spring-Boot-应用程序-Installing-Spring-Boot-Applications"><a href="#安装-Spring-Boot-应用程序-Installing-Spring-Boot-Applications" class="headerlink" title="安装 Spring Boot 应用程序(Installing Spring Boot Applications)"></a>安装 Spring Boot 应用程序(Installing Spring Boot Applications)</h5><p>除了使用 <code>java -jar</code> 运行 Spring Boot 应用程序之外,还可以为 Unix 系统制作完全可执行的应用程序.一个完整的可执行的 jar 可以像任何其他可执行二进制文件一样执行,也可以用 <code>init.d</code> 或 <code>systemd</code> 注册.这有助于在生产环境中安装和管理 Spring Boot 应用程序.</p>
<blockquote>
<p>警告:</p>
<p>​    完全可执行的 jars 通过在文件前面嵌入一个额外的脚本来工作.目前,一些工具不接受这种格式,因此并不总能用这种技术.例如,<code>jar -xf</code> 可能无法提取已被制作成完全可执行的 jar 或 war.建议仅在打算直接执行时才使 jar 或 war 完全可执行,而不是使用 <code>java -jar</code> 运行它或将其部署到 servlet 容器.</p>
<p>警告:</p>
<p>​    无法使 zip64 格式的 jar 文件完全可执行.尝试这样做会导致 jar 文件在直接执行或使用 <code>java -jar</code> 执行时报告为损坏.包含一个或多个 zip64 格式嵌套 jar 的标准格式 jar 文件可以是完全可执行的.</p>
</blockquote>
<p>要使用 Maven 创建”完全可执行”的 jar,请使用以下插件配置:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executable</span>&gt;</span>true<span class="tag">&lt;/<span class="name">executable</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>以下示例显示了等效的 Gradle 配置:</p>
<figure class="highlight gradle"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bootJar {</span><br><span class="line">    launchScript()</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>然后,可以通过输入 <code>./my-application.jar</code>(其中 <code>my-application</code> 是artifact的名称)来运行应用程序.</p>
<ol>
<li><h6 id="支持的操作系统-Supported-Operating-Systems"><a href="#支持的操作系统-Supported-Operating-Systems" class="headerlink" title="支持的操作系统(Supported Operating Systems)"></a>支持的操作系统(Supported Operating Systems)</h6><p>默认脚本支持大多数 Linux 发行版,并在 CentOS 和 Ubuntu 上进行了测试.其他平台,例如 OS X 和 FreeBSD,需要使用自定义的 <code>EmbeddedLaunchScript</code>.</p>
</li>
<li><h6 id="Unix-Linux-服务"><a href="#Unix-Linux-服务" class="headerlink" title="Unix/Linux 服务"></a>Unix/Linux 服务</h6><p>使用 <code>init.d</code> 或 <code>systemd</code> 可以轻松地将 Spring Boot 应用程序作为 Unix/Linux 服务启动.</p>
<ol>
<li><h6 id="安装为-init-d-服务-System-V-Installation-as-an-init-d-Service-System-V"><a href="#安装为-init-d-服务-System-V-Installation-as-an-init-d-Service-System-V" class="headerlink" title="安装为 init.d 服务(System V)(Installation as an init.d Service (System V))"></a>安装为 init.d 服务(System V)(Installation as an init.d Service (System V))</h6><p>如果将 Spring Boot 的 Maven 或 Gradle 插件配置为生成完全可执行的 jar,并且不使用自定义的 <code>EmbeddedLaunchScript</code>,则应用可以用作 <code>init.d</code> 服务.为此,将 jar 符号链接到 <code>init.d</code> 以支持标准的<code>start</code>,<code>stop</code>,<code>restart</code>和<code>status</code>命令.</p>
<p>该脚本支持以下功能:</p>
<ul>
<li>以拥有 jar 文件的用户身份启动服务</li>
<li>使用 <code>/var/run/&lt;appname&gt;/&lt;appname&gt;.pid</code> 跟踪应用程序的 PID</li>
<li>将控制台日志写入 <code>/var/log/&lt;appname&gt;.log</code></li>
</ul>
<p>假设 <code>/var/myapp</code> 中安装了 Spring Boot 应用程序,要将 Spring Boot 应用程序安装为 <code>init.d</code> 服务,请创建一个符号链接,如下所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ln -s /var/myapp/myapp.jar /etc/init.d/myapp</span></span><br></pre></td></tr></tbody></table></figure>

<p>安装后,可以按照平常的方式启动和停止服务. 例如,在基于 Debian 的系统上,可以使用以下命令启动它:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> service myapp start</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>建议:</p>
<p>​    如果应用程序无法启动,请检查写入 <code>/var/log/&lt;appname&gt;.log</code> 的日志文件是否有错误.</p>
</blockquote>
<p>还可以使用标准操作系统工具将应用程序标记为自动启动. 例如,在 Debian 上,可以使用以下命令:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> update-rc.d myapp defaults &lt;priority&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<h6 id="Securing-an-init-d-Service"><a href="#Securing-an-init-d-Service" class="headerlink" title="Securing an init.d Service"></a>Securing an init.d Service</h6><blockquote>
<p>建议:</p>
<p>​    以下是关于如何保护作为 <code>init.d</code> 服务运行的 Spring Boot 应用程序的一组指南.</p>
</blockquote>
<p>当以 root 身份执行时,就像使用 root 启动 init.d 服务一样,默认的可执行脚本以 <code>RUN_AS_USER</code> 环境变量中指定的用户身份运行应用程序.当未设置环境变量时,将使用拥有 jar 文件的用户.永远不应该以 root 身份运行 Spring Boot 应用程序,因此 <code>RUN_AS_USER</code> 永远不应该是 root,并且应用的 jar 文件不应该由 root 拥有.相反,创建一个特定用户来运行应用并设置 <code>RUN_AS_USER</code> 环境变量或使用 <code>chown</code> 使其成为 jar 文件的所有者,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chown bootapp:bootapp your-app.jar</span></span><br></pre></td></tr></tbody></table></figure>

<p>在这种情况下,默认的可执行脚本以 <code>bootapp</code> 用户身份运行应用程序.</p>
<blockquote>
<p>建议:</p>
<p>​    为了减少应用程序的用户帐户被盗用的可能性,应该考虑阻止它使用登录 shell.例如,可以将帐户的 shell 设置为 <code>/usr/sbin/nologin</code>.</p>
</blockquote>
<p>还应该采取措施防止修改应用的 jar 文件.首先配置它的权限,使其不能写入,只能由其所有者读取或执行,如下例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod 500 your-app.jar</span></span><br></pre></td></tr></tbody></table></figure>

<p>其次,如果应用或运行它的帐户受到损害,还应该采取措施限制损害.如果攻击者确实获得了访问权限,他们可以使 jar 文件可写并更改其内容. 防止这种情况的一种方法是使用 <code>chattr</code> 使其不可变,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo chattr +i your-app.jar</span></span><br></pre></td></tr></tbody></table></figure>

<p>这将防止任何用户(包括 root)修改 jar.</p>
<p>如果 root 用于控制应用的服务,并且使用 <code>.conf</code> 文件自定义其启动,则 <code>.conf</code> 文件将由 root 用户读取和evaluate.应相应地加以保护.使用 <code>chmod</code> 使文件只能由所有者读取,并使用 <code>chown</code> 使 root 成为所有者,如下例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> chmod 400 your-app.conf$ sudo chown root:root your-app.conf</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="安装为-systemd-服务-Installation-as-a-systemd-Service"><a href="#安装为-systemd-服务-Installation-as-a-systemd-Service" class="headerlink" title="安装为 systemd 服务( Installation as a systemd Service)"></a>安装为 systemd 服务( Installation as a systemd Service)</h6><p><code>systemd</code> 是 System V init 系统的继承者,现在被许多现代 Linux 发行版使用.虽然可以继续使用 <code>systemd</code> 的 <code>init.d</code> 脚本,但也可以使用 <code>systemd</code> 的”service”脚本启动 Spring Boot 应用程序.</p>
<p>假设在 <code>/var/myapp</code> 中安装了 Spring Boot 应用程序,要将 Spring Boot 应用程序安装为 <code>systemd</code> 服务,则创建一个名为 <code>myapp.service</code> 的脚本并将其放置在 <code>/etc/systemd/system</code> 目录中. 以下脚本提供了一个示例:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Unit]Description=myappAfter=syslog.target[Service]User=myappExecStart=/var/myapp/myapp.jarSuccessExitStatus=143[Install]WantedBy=multi-user.target</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>重要:</p>
<p>​    请记住更改应用程序的<code>Description</code>,<code>User</code>和<code>ExecStart</code>字段.</p>
<p>注意:</p>
<p>​    <code>ExecStart</code> 字段没有声明脚本操作命令,这意味着默认使用运行命令.</p>
</blockquote>
<p>请注意,与作为 <code>init.d</code> 服务运行时不同,运行应用程序的用户,PID 文件和控制台日志文件由 <code>systemd</code> 本身管理,因此必须使用”service”脚本中的适当字段进行配置.</p>
<p>要将应用程序标记为在系统启动时自动启动,请使用以下命令:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> systemctl <span class="built_in">enable</span> myapp.service</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="自定义启动脚本-Customizing-the-Startup-Script"><a href="#自定义启动脚本-Customizing-the-Startup-Script" class="headerlink" title="自定义启动脚本(Customizing the Startup Script)"></a>自定义启动脚本(Customizing the Startup Script)</h6><p>可以通过多种方式自定义由 Maven 或 Gradle 插件编写的默认嵌入式启动脚本.对于大多数人来说,使用默认脚本和一些自定义通常就足够了.如果发现无法自定义所需的内容,请使用 <code>EmbeddedLaunchScript</code> 选项完全编写自己的文件.</p>
<h6 id="写入时自定义启动脚本"><a href="#写入时自定义启动脚本" class="headerlink" title="写入时自定义启动脚本"></a>写入时自定义启动脚本</h6><p>在写入 jar 文件时自定义启动脚本的元素通常是有意义的.例如,<code>init.d</code> 脚本可以提供”description”. 由于预先知道描述(并且不需要更改),因此最好在生成 jar 时提供它.</p>
<p>要自定义写入的元素,请使用 Spring Boot Maven 插件的 <code>EmbeddedLaunchScriptProperties</code> 选项或 Spring Boot Gradle 插件的 <code>launchScript</code> 的 properties 属性( <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/gradle-plugin/reference/htmlsingle/#packaging-executable-configuring-launch-script"><code>properties</code> property of the Spring Boot Gradle plugin’s <code>launchScript</code></a>.).</p>
<p>默认脚本支持以下属性替换:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
<th>Gradle default</th>
<th>Maven default</th>
</tr>
</thead>
<tbody><tr>
<td><code>mode</code></td>
<td>脚本模式.</td>
<td><code>auto</code></td>
<td><code>auto</code></td>
</tr>
<tr>
<td><code>initInfoProvides</code></td>
<td>“INIT INFO”的”提供”部分</td>
<td><code>${task.baseName}</code></td>
<td><code>${project.artifactId}</code></td>
</tr>
<tr>
<td><code>initInfoRequiredStart</code></td>
<td>“INIT INFO”的”Required-Start”部分.</td>
<td><code>$remote_fs $syslog $network</code></td>
<td><code>$remote_fs $syslog $network</code></td>
</tr>
<tr>
<td><code>initInfoRequiredStop</code></td>
<td>“INIT INFO”的”Required-Stop”部分.</td>
<td><code>$remote_fs $syslog $network</code></td>
<td><code>$remote_fs $syslog $network</code></td>
</tr>
<tr>
<td><code>initInfoDefaultStart</code></td>
<td>“INIT INFO”的”Default-Start”部分.</td>
<td><code>2 3 4 5</code></td>
<td><code>2 3 4 5</code></td>
</tr>
<tr>
<td><code>initInfoDefaultStop</code></td>
<td>“初始化信息”的”默认停止”部分.</td>
<td><code>0 1 6</code></td>
<td><code>0 1 6</code></td>
</tr>
<tr>
<td><code>initInfoShortDescription</code></td>
<td>“INIT INFO”的”Short-Description”部分.</td>
<td><code>${project.description}</code> 的单行版本(回退到 <code>${task.baseName}</code>)</td>
<td><code>${project.name}</code></td>
</tr>
<tr>
<td><code>initInfoDescription</code></td>
<td>“INIT INFO”的”描述”部分.</td>
<td><code>${project.description}</code>(回退到 <code>${task.baseName}</code>)</td>
<td><code>${project.description}</code>(回退到 <code>${project.name}</code>)</td>
</tr>
<tr>
<td><code>initInfoChkconfig</code></td>
<td>“INIT INFO”的<code>chkconfig</code>部分</td>
<td><code>2345 99 01</code></td>
<td><code>2345 99 01</code></td>
</tr>
<tr>
<td><code>confFolder</code></td>
<td><code>CONF_FOLDER</code> 的默认值</td>
<td>包含 jar 的文件夹</td>
<td>包含 jar 的文件夹</td>
</tr>
<tr>
<td><code>inlinedConfScript</code></td>
<td>对应内联在默认启动脚本中的文件脚本的引用. 这可用于在加载任何外部配置文件之前设置环境变量,例如<code>JAVA_OPTS</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>logFolder</code></td>
<td><code>LOG_FOLDER</code> 的默认值. 仅对 <code>init.d</code> 服务有效</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>logFilename</code></td>
<td><code>LOG_FILENAME</code> 的默认值. 仅对 <code>init.d</code> 服务有效</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>pidFolder</code></td>
<td><code>PID_FOLDER</code> 的默认值. 仅对 <code>init.d</code> 服务有效</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>pidFilename</code></td>
<td><code>PID_FOLDER</code> 中 PID 文件名称的默认值. 仅对 <code>init.d</code> 服务有效</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>useStartStopDaemon</code></td>
<td>是否应该使用 <code>start-stop-daemon</code> 命令(当它可用时)来控制进程</td>
<td><code>true</code></td>
<td><code>true</code></td>
</tr>
<tr>
<td><code>stopWaitTime</code></td>
<td><code>STOP_WAIT_TIME</code> 的默认值(以秒为单位). 仅对 <code>init.d</code> 服务有效</td>
<td>60</td>
<td>60</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h6 id="在运行时自定义脚本-Customizing-a-Script-When-It-Runs"><a href="#在运行时自定义脚本-Customizing-a-Script-When-It-Runs" class="headerlink" title="在运行时自定义脚本(Customizing a Script When It Runs)"></a>在运行时自定义脚本(Customizing a Script When It Runs)</h6><p>jar 写好后需要自定义的脚本项,可以使用环境变量或配置文件.</p>
<p>默认脚本支持以下环境属性:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td><code>MODE</code></td>
<td>操作的”模式”. 默认值取决于 jar 的构建方式,但通常是 <code>auto</code>(这意味着它试图通过检查它是否是名为 <code>init.d</code> 的目录中的符号链接来猜测它是否是一个 init 脚本). 可以将其显式设置为 <code>service</code>,以便 `stop</td>
</tr>
<tr>
<td><code>RUN_AS_USER</code></td>
<td>将用于运行应用程序的用户. 未设置时,将使用拥有 jar 文件的用户.</td>
</tr>
<tr>
<td><code>USE_START_STOP_DAEMON</code></td>
<td>是否应使用”<code>start-stop-daemon</code>“命令(如果可用)来控制进程. 默认为”真”.</td>
</tr>
<tr>
<td><code>PID_FOLDER</code></td>
<td>pid 文件夹的根名称(默认为<code>/var/run</code>).</td>
</tr>
<tr>
<td><code>LOG_FOLDER</code></td>
<td>放置日志文件的文件夹的名称(默认为<code>/var/log</code>).</td>
</tr>
<tr>
<td><code>CONF_FOLDER</code></td>
<td>从中读取 .conf 文件的文件夹的名称(默认与 jar-file 相同的文件夹).</td>
</tr>
<tr>
<td><code>LOG_FILENAME</code></td>
<td><code>LOG_FOLDER</code> 中日志文件的名称(默认为 <code>&lt;appname&gt;.log</code>).</td>
</tr>
<tr>
<td><code>APP_NAME</code></td>
<td>应用程序的名称. 如果 jar 是从符号链接运行的,则脚本会猜测应用程序名称. 如果它不是符号链接或者想明确设置应用程序名称,这可能很有用.</td>
</tr>
<tr>
<td><code>RUN_ARGS</code></td>
<td>传递给程序(Spring Boot 应用程序)的参数.</td>
</tr>
<tr>
<td><code>JAVA_HOME</code></td>
<td><code>java</code> 可执行文件的位置默认使用 <code>PATH</code> 发现,但如果 <code>$JAVA_HOME/bin/java</code> 中有一个可执行文件,你可以显式设置它.</td>
</tr>
<tr>
<td><code>JAVA_OPTS</code></td>
<td>JVM 启动时传递给它的选项.</td>
</tr>
<tr>
<td><code>JARFILE</code></td>
<td>jar 文件的显式位置,以防脚本用于启动实际上并未嵌入的 jar.</td>
</tr>
<tr>
<td><code>DEBUG</code></td>
<td>如果不为空,则在 shell 进程上设置 <code>-x</code> 标志,允许查看脚本中的逻辑.</td>
</tr>
<tr>
<td><code>STOP_WAIT_TIME</code></td>
<td>在强制关闭之前停止应用程序时等待的时间(以秒为单位)(默认为”60”).</td>
</tr>
</tbody></table>
<blockquote>
<p>注意:</p>
<p>​    <code>PID_FOLDER</code>,<code>LOG_FOLDER</code> 和 <code>LOG_FILENAME</code> 变量仅对 <code>init.d</code> 服务有效. 对于”<code>systemd</code>“,使用”service”脚本进行等效的自定义.</p>
</blockquote>
<p>除了 <code>JARFILE</code> 和 <code>APP_NAME</code> 之外,可以使用 <code>.conf</code> 文件配置上一节中列出的设置.该文件应该在 jar 文件旁边,并且具有相同的名称,但后缀为 <code>.conf</code> 而不是 <code>.jar</code>. 例如,名为 <code>/var/myapp/myapp.jar</code> 的 jar 使用名为 <code>/var/myapp/myapp.conf</code> 的配置文件,如下例所示:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JAVA_OPTS=-Xmx1024MLOG_FOLDER=/custom/log/folder</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>建议:</p>
<p>​    如果不喜欢在 jar 文件旁边放置配置文件,可以设置一个 <code>CONF_FOLDER</code> 环境变量来自定义配置文件的位置.</p>
</blockquote>
</li>
</ol>
</li>
<li><h6 id="Microsoft-Windows-服务-Microsoft-Windows-Services"><a href="#Microsoft-Windows-服务-Microsoft-Windows-Services" class="headerlink" title="Microsoft Windows 服务(Microsoft Windows Services)"></a>Microsoft Windows 服务(Microsoft Windows Services)</h6><p>可以使用 <a target="_blank" rel="noopener" href="https://github.com/kohsuke/winsw"><code>winsw</code></a> 将 Spring Boot 应用程序作为 Windows 服务启动.</p>
<p>A (<a target="_blank" rel="noopener" href="https://github.com/snicol/spring-boot-daemon">单独维护的示例</a>) 描述了如何为 Spring Boot 应用程序创建 Windows 服务的分步说明.</p>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/37726.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/37726.html" class="post-title-link" itemprop="url">5.2 Deploy:  部署到云</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:36:00 / 修改时间：13:02:40" itemprop="dateCreated datePublished" datetime="2021-06-10T12:36:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/37726.html" class="post-meta-item leancloud_visitors" data-flag-title="5.2 Deploy:  部署到云" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="2">
<li><h5 id="部署到云-Deploying-to-the-Cloud"><a href="#部署到云-Deploying-to-the-Cloud" class="headerlink" title="部署到云(Deploying to the Cloud)"></a>部署到云(Deploying to the Cloud)</h5><p>Spring Boot 的可执行 jar 是为大多数流行的云 PaaS(平台即服务)提供商准备的.这些提供商往往要求”自带容器”.他们管理应用进程(不是专门的 Java 应用程序),因此需要一个中间层,使开发者的应用程序适应云中正在运行的进程的概念.</p>
<p>两个流行的云提供商 Heroku 和 Cloud Foundry 采用”buildpack”方法.buildpack 将部署的代码包装在启动应用所需的所有内容中. 它可能是 JDK 和对 <code>java</code> 的调用,嵌入式 Web 服务器或成熟的应用程序服务器.buildpack 是可插拔的,但理想情况下,应该尽可能少地自定义.这减少了不受控制的功能的占用空间. 它最大限度地减少了开发和生产环境之间的差异.</p>
<p>理想情况下,应用程序,就像一个 Spring Boot 可执行 jar,将运行所需的一切都打包在其中.</p>
<ol>
<li><h6 id="Cloud-Foundry"><a href="#Cloud-Foundry" class="headerlink" title="Cloud Foundry"></a>Cloud Foundry</h6><p>Cloud Foundry 提供了默认构建包,如果没有指定其他构建包,这些构建包就会发挥作用.Cloud Foundry Java buildpack 对包括 Spring Boot 在内的 Spring 应用程序有很好的支持.可以部署独立的可执行 jar 应用程序以及传统的 <code>.war</code> 打包应用程序.</p>
<p>构建应用程序(例如,通过使用 <code>mvn clean package</code>)并安装 cf 命令行工具后,使用 <code>cf push</code> 命令部署应用程序,替换已编译的 <code>.jar</code> 的路径.在推送应用程序之前,请确保已使用 cf 命令行客户端登录. 以下行显示使用 <code>cf push</code> 命令部署应用程序:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cf push acloudyspringtime -p target/demo-0.0.1-SNAPSHOT.jar</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意:</p>
<p>​    在前面的示例中,将 <code>acloudyspringtime</code> 替换为给 cf 作为应用程序名称的任何值.</p>
</blockquote>
<p>如果同一目录中存在 Cloud Foundry <code>manifest.yml</code> 文件,则会考虑该文件.此时,<code>cf</code> 开始上传您的应用程序,生成类似于以下示例的输出:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Uploading acloudyspringtime... OK</span><br><span class="line">Preparing to start acloudyspringtime... OK</span><br><span class="line">-----&gt; Downloaded app package (8.9M)</span><br><span class="line">-----&gt; Java Buildpack Version: v3.12 (offline) | https://github.com/cloudfoundry/java-buildpack.git#6f25b7e</span><br><span class="line">-----&gt; Downloading Open Jdk JRE 1.8.0_121 from https://java-buildpack.cloudfoundry.org/openjdk/trusty/x86_64/openjdk-1.8.0_121.tar.gz (found in cache)</span><br><span class="line">       Expanding Open Jdk JRE to .java-buildpack/open_jdk_jre (1.6s)</span><br><span class="line">-----&gt; Downloading Open JDK Like Memory Calculator 2.0.2_RELEASE from https://java-buildpack.cloudfoundry.org/memory-calculator/trusty/x86_64/memory-calculator-2.0.2_RELEASE.tar.gz (found in cache)</span><br><span class="line">       Memory Settings: -Xss349K -Xmx681574K -XX:MaxMetaspaceSize=104857K -Xms681574K -XX:MetaspaceSize=104857K</span><br><span class="line">-----&gt; Downloading Container Certificate Trust Store 1.0.0_RELEASE from https://java-buildpack.cloudfoundry.org/container-certificate-trust-store/container-certificate-trust-store-1.0.0_RELEASE.jar (found in cache)</span><br><span class="line">       Adding certificates to .java-buildpack/container_certificate_trust_store/truststore.jks (0.6s)</span><br><span class="line">-----&gt; Downloading Spring Auto Reconfiguration 1.10.0_RELEASE from https://java-buildpack.cloudfoundry.org/auto-reconfiguration/auto-reconfiguration-1.10.0_RELEASE.jar (found in cache)</span><br><span class="line">Checking status of app 'acloudyspringtime'...</span><br><span class="line">  0 of 1 instances running (1 starting)</span><br><span class="line">  ...</span><br><span class="line">  0 of 1 instances running (1 starting)</span><br><span class="line">  ...</span><br><span class="line">  0 of 1 instances running (1 starting)</span><br><span class="line">  ...</span><br><span class="line">  1 of 1 instances running (1 running)</span><br><span class="line"></span><br><span class="line">App started</span><br></pre></td></tr></tbody></table></figure>

<p>恭喜！ 该应用程序现已上线！</p>
<p>应用程序上线后,可以使用 <code>cf apps</code> 命令验证已部署应用程序的状态,如以下示例所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cf apps</span></span><br><span class="line">Getting applications in ...</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">name                 requested state   instances   memory   disk   urls</span><br><span class="line">...</span><br><span class="line">acloudyspringtime    started           1/1         512M     1G     acloudyspringtime.cfapps.io</span><br><span class="line">...</span><br></pre></td></tr></tbody></table></figure>

<p>一旦 Cloud Foundry 确认应用程序已部署,应该能够在给定的 URI 中找到该应用程序.在前面的示例中,可以在 <a target="_blank" rel="noopener" href="https://acloudyspringtime.cfapps.io/">https://acloudyspringtime.cfapps.io/</a> 找到它.</p>
<ol>
<li><h6 id="绑定到服务-Binding-to-Services"><a href="#绑定到服务-Binding-to-Services" class="headerlink" title="绑定到服务(Binding to Services)"></a>绑定到服务(Binding to Services)</h6><p>默认情况下,有关应用的元数据以及服务连接信息作为环境变量公开给应用程序(例如:<code>$VCAP_SERVICES</code>).这个架构决定是由于 Cloud Foundry 的多语言(任何语言和平台都可以作为 buildpack 支持)的性质而决定的.作用在进程作用域的环境变量与语言无关.</p>
<p>环境变量并不总是最简单的 API,因此 Spring Boot 会自动提取它们并将数据扁平化为可以通过 Spring 的 <code>Environment</code> 抽象访问的属性,如以下示例所示:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">EnvironmentAware</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String instanceId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnvironment</span><span class="params">(Environment environment)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.instanceId = environment.getProperty(<span class="string">"vcap.application.instance_id"</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>所有 Cloud Foundry 属性都以 <code>vcap</code> 为前缀. 可以使用 <code>vcap</code> 属性访问应用程序信息(例如应用程序的公共 URL)和服务信息(例如数据库凭据).</p>
</li>
<li><h6 id="Kubernetes"><a href="#Kubernetes" class="headerlink" title="Kubernetes"></a>Kubernetes</h6><p>Spring Boot 通过检查环境中的”<code>*_SERVICE_HOST</code>“和”<code>*_SERVICE_PORT</code>“变量来自动检测 Kubernetes 部署环境.可以使用 <code>spring.main.cloud-platform</code> 配置属性覆盖此检测.</p>
<ol>
<li><h6 id="Kubernetes-Container-Lifecycle"><a href="#Kubernetes-Container-Lifecycle" class="headerlink" title="Kubernetes Container Lifecycle"></a>Kubernetes Container Lifecycle</h6><p>当 Kubernetes 删除应用实例时,关闭过程同时涉及多个子系统:shutdown hooks,取消注册服务,从负载均衡器中移除实例……由于此关闭处理并行发生(并且由于分布式系统的性质),因此存在一个窗口,在此期间流量可以路由到已开始关闭处理的 pod.</p>
<p>可以在 preStop 处理程序中配置sleep execution ,避免将请求路由到已经开始关闭的 pod.睡眠时间应该足够长,以便新请求停止路由到 pod,其持续时间会因部署而异.preStop 处理程序可以通过 Pod 配置文件中的 PodSpec 进行配置,如下所示:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">example-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example-image</span></span><br><span class="line">    <span class="attr">lifecycle:</span></span><br><span class="line">      <span class="attr">preStop:</span></span><br><span class="line">        <span class="attr">exec:</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"sleep 10"</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>一旦 <code>pre-stop</code> 钩子完成,SIGTERM 将被发送到容器并开始正常关闭,并且允许任何剩余的正在进行的请求完成.</p>
</li>
</ol>
</li>
<li><h6 id="Heroku"><a href="#Heroku" class="headerlink" title="Heroku"></a>Heroku</h6><p>Heroku 是另一个流行的 PaaS 平台.要自定义 Heroku 构建,需要提供一个 <code>Procfile</code>,它提供部署应用程序所需的指令.. Heroku 分配一个端口供 Java 应用程序使用,然后确保路由到外部 URI 的工作正常.</p>
<p>必须将应用程序配置为监听正确的端口. 以下示例显示了入门 REST 应用程序的 <code>Procfile</code>:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web: java -Dserver.port=$PORT -jar target/demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></tbody></table></figure>

<p>Spring Boot 使 <code>-D</code> 参数可以像访问 Spring Environment 实例属性一样访问.<code>server.port</code> 配置属性被提供给嵌入式 Tomcat,Jetty 或 Undertow 实例,然后在启动时使用该端口.<code>$PORT</code> 环境变量由 Heroku PaaS 分配.</p>
<p>需要做的应该就这么多. Heroku 部署最常见的部署工作流是 <code>git push</code> 代码到生产环境,如下面的例子所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push heroku main</span></span><br></pre></td></tr></tbody></table></figure>

<p>这将输出以下结果:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Initializing repository, done.</span><br><span class="line">Counting objects: 95, done.</span><br><span class="line">Delta compression using up to 8 threads.</span><br><span class="line">Compressing objects: 100% (78/78), done.</span><br><span class="line">Writing objects: 100% (95/95), 8.66 MiB | 606.00 KiB/s, done.</span><br><span class="line">Total 95 (delta 31), reused 0 (delta 0)</span><br><span class="line"></span><br><span class="line">-----&gt; Java app detected</span><br><span class="line">-----&gt; Installing OpenJDK 1.8... done</span><br><span class="line">-----&gt; Installing Maven 3.3.1... done</span><br><span class="line">-----&gt; Installing settings.xml... done</span><br><span class="line">-----&gt; Executing: mvn -B -DskipTests=true clean install</span><br><span class="line"></span><br><span class="line">       [INFO] Scanning for projects...</span><br><span class="line">       Downloading: https://repo.spring.io/...</span><br><span class="line">       Downloaded: https://repo.spring.io/... (818 B at 1.8 KB/sec)</span><br><span class="line">        ....</span><br><span class="line">       Downloaded: https://s3pository.heroku.com/jvm/... (152 KB at 595.3 KB/sec)</span><br><span class="line">       [INFO] Installing /tmp/build_0c35a5d2-a067-4abc-a232-14b1fb7a8229/target/...</span><br><span class="line">       [INFO] Installing /tmp/build_0c35a5d2-a067-4abc-a232-14b1fb7a8229/pom.xml ...</span><br><span class="line">       [INFO] ------------------------------------------------------------------------</span><br><span class="line">       [INFO] BUILD SUCCESS</span><br><span class="line">       [INFO] ------------------------------------------------------------------------</span><br><span class="line">       [INFO] Total time: 59.358s</span><br><span class="line">       [INFO] Finished at: Fri Mar 07 07:28:25 UTC 2014</span><br><span class="line">       [INFO] Final Memory: 20M/493M</span><br><span class="line">       [INFO] ------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">-----&gt; Discovering process types</span><br><span class="line">       Procfile declares types -&gt; web</span><br><span class="line"></span><br><span class="line">-----&gt; Compressing... done, 70.4MB</span><br><span class="line">-----&gt; Launching... done, v6</span><br><span class="line">       https://agile-sierra-1405.herokuapp.com/ deployed to Heroku</span><br><span class="line"></span><br><span class="line">To git@heroku.com:agile-sierra-1405.git</span><br><span class="line"> * [new branch]      main -&gt; main</span><br></pre></td></tr></tbody></table></figure>

<p>应用现在应该在 Heroku 上启动并运行.</p>
</li>
<li><h6 id="OpenShift"><a href="#OpenShift" class="headerlink" title="OpenShift"></a>OpenShift</h6><p>OpenShift 有许多资源描述了如何部署 Spring Boot 应用程序,包括:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://blog.openshift.com/using-openshift-enterprise-grade-spring-boot-deployments/">Using the S2I builder</a></li>
<li><a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/en-us/reference_architectures/2017/html-single/spring_boot_microservices_on_red_hat_openshift_container_platform_3/">Architecture guide</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.openshift.com/using-spring-boot-on-openshift/">Running as a traditional web application on Wildfly</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.openshift.com/openshift-commons-briefing-96-cloud-native-applications-spring-rhoar/">OpenShift Commons Briefing</a></li>
</ul>
</li>
<li><h6 id="Amazon-Web-Services-AWS"><a href="#Amazon-Web-Services-AWS" class="headerlink" title="Amazon Web Services (AWS)"></a>Amazon Web Services (AWS)</h6><p>Amazon Web Services 提供了多种安装 Spring Boot 的应用的方法,可以是传统的 Web 应用程序 (war),也可以是带有嵌入式 Web 服务器的可执行 jar 文件.</p>
<p>选项包括:</p>
<ul>
<li>AWS Elastic Beanstalk</li>
<li>AWS Code Deploy</li>
<li>AWS OPS Works</li>
<li>AWS Cloud Formation</li>
<li>AWS Container Registry</li>
</ul>
<p>每个都有不同的功能和定价模型. 在本文档中,我们描述了使用 AWS Elastic Beanstalk 的方法.</p>
<ol>
<li><h6 id="AWS-Elastic-Beanstalk"><a href="#AWS-Elastic-Beanstalk" class="headerlink" title="AWS Elastic Beanstalk"></a>AWS Elastic Beanstalk</h6><p>如官方 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_Java.html">Elastic Beanstalk Java guide</a> 指南中所述,有两个主要选项来部署 Java 应用程序. 可以使用”Tomcat 平台”或”Java SE 平台”.</p>
<h6 id="Using-the-Tomcat-Platform"><a href="#Using-the-Tomcat-Platform" class="headerlink" title="Using the Tomcat Platform"></a>Using the Tomcat Platform</h6><p>此选项适用于生成 war 文件的 Spring Boot 项目. 无需特殊配置. 只需要遵循官方指南.</p>
<h6 id="Using-the-Java-SE-Platform"><a href="#Using-the-Java-SE-Platform" class="headerlink" title="Using the Java SE Platform"></a>Using the Java SE Platform</h6><p>此选项适用于生成 jar 文件,并运行嵌入式 Web 容器的 Spring Boot 项目.Elastic Beanstalk 环境在端口 <code>80</code> 上运行一个 nginx 实例来代理在端口 5000 上运行的真正的应用.要配置它,请将以下行添加到 <code>application.properties</code> 文件中:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server.port=5000</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>建议:</p>
<p>​    <em>上传二进制文件而不是源文件</em></p>
<p>​    默认情况下,Elastic Beanstalk 上传源代码并在 AWS 中编译它们.但是,最好改为上传二进制文件.为此,请将类似于以下内容的行添加到 <code>.elasticbeanstalk/config.yml</code> 文件中:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;deploy:artifact: target/demo-0.0.1-SNAPSHOT.jar</span><br></pre></td></tr></tbody></table></figure>



<p>建议:</p>
<p>​    <em>通过设置环境类型降低性能开销</em></p>
<p>​    默认情况下,Elastic Beanstalk 环境是负载平衡的.负载均衡器的成本很高.为避免该成本,请将环境类型设置为”Single instance”,如 <a target="_blank" rel="noopener" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-capacity">the Amazon documentation</a>中所述. 还可以使用 CLI 和以下命令创建单实例环境:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;eb create -s</span><br></pre></td></tr></tbody></table></figure></blockquote>
</li>
<li><h6 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h6><p>这是访问 AWS 的最简单方法之一,但还有更多内容需要介绍,例如如何将 Elastic Beanstalk 集成到任何 CI/CD 工具中,使用 Elastic Beanstalk Maven 插件而不是 CLI,等等. 有一篇 <a target="_blank" rel="noopener" href="https://exampledriven.wordpress.com/2017/01/09/spring-boot-aws-elastic-beanstalk-example/">blog post</a> 更详细地介绍了这些主题.</p>
</li>
</ol>
</li>
<li><h6 id="Boxfuse-和Amazon-网络服务"><a href="#Boxfuse-和Amazon-网络服务" class="headerlink" title="Boxfuse 和Amazon 网络服务"></a>Boxfuse 和Amazon 网络服务</h6><p>Boxfuse 的工作原理是将您的 Spring Boot 可执行 jar 或 war 转换为最小的 VM 镜像,该镜像可以以不可修改的方式在 VirtualBox 或 AWS 上部署.Boxfuse 与 Spring Boot 深度集成,并使用 Spring Boot 配置文件中的信息自动配置端口和健康检查 URL.Boxfuse 将这些信息用于它生成的图像以及它提供的所有资源(实例,安全组,弹性负载均衡器等).</p>
<p>如果创建了 Boxfuse 账户,将其连接到 AWS 账户,安装了最新版本的 Boxfuse 客户端,并确保应用程序已由 Maven 或 Gradle 构建(例如,通过使用 <code>mvn clean package</code>),可以使用类似于以下的命令将 Spring Boot 应用程序部署到 AWS:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> boxfuse run myapp-1.0.jar -env=prod</span></span><br></pre></td></tr></tbody></table></figure>

<p>如果当前目录中存在 <code>boxfuse.conf</code> 文件,则使用该文件.</p>
<blockquote>
<p>建议:</p>
<p>​    默认情况下,Boxfuse 在启动时激活一个名为 <code>boxfuse</code> 的 Spring 配置文件.如果可执行 jar 或 war 包含 <code>application-boxfuse.properties</code> 文件,则 Boxfuse 将根据其包含的属性进行配置.</p>
</blockquote>
<p>此时,<code>boxfuse</code> 为应用程序创建一个镜像,上传它,并在 AWS 上配置和启动必要的资源,产生类似于以下示例的输出:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fusing Image for myapp-1.0.jar ...Image fused in 00:06.838s (53937 K) -&gt; axelfontaine/myapp:1.0Creating axelfontaine/myapp ...Pushing axelfontaine/myapp:1.0 ...Verifying axelfontaine/myapp:1.0 ...Creating Elastic IP ...Mapping myapp-axelfontaine.boxfuse.io to 52.28.233.167 ...Waiting for AWS to create an AMI for axelfontaine/myapp:1.0 in eu-central-1 (this may take up to 50 seconds) ...AMI created in 00:23.557s -&gt; ami-d23f38cfCreating security group boxfuse-sg_axelfontaine/myapp:1.0 ...Launching t2.micro instance of axelfontaine/myapp:1.0 (ami-d23f38cf) in eu-central-1 ...Instance launched in 00:30.306s -&gt; i-92ef9f53Waiting for AWS to boot Instance i-92ef9f53 and Payload to start at https://52.28.235.61/ ...Payload started in 00:29.266s -&gt; https://52.28.235.61/Remapping Elastic IP 52.28.233.167 to i-92ef9f53 ...Waiting 15s for AWS to complete Elastic IP Zero Downtime transition ...Deployment completed successfully. axelfontaine/myapp:1.0 is up and running at https://myapp-axelfontaine.boxfuse.io/</span><br></pre></td></tr></tbody></table></figure>

<p>应用程序现在应该在 AWS 上启动并运行.请参阅关于 <a target="_blank" rel="noopener" href="https://boxfuse.com/blog/spring-boot-ec2.html">在 EC2 上部署 Spring Boot 应用程序</a> 以及 <a target="_blank" rel="noopener" href="https://boxfuse.com/blog/spring-boot-ec2.html">Boxfuse Spring Boot 集成文档</a> ) 开始使用 Maven 构建来运行应用程序.</p>
</li>
<li><h6 id="Google-Cloud"><a href="#Google-Cloud" class="headerlink" title="Google Cloud"></a>Google Cloud</h6><p>Google Cloud 有多个选项可用于启动 Spring Boot 应用程序.最容易的可能是 App Engine,但也可以找到在带有 Container Engine 的容器中或在带有 Compute Engine 的虚拟机上运行 Spring Boot 的方法.</p>
<p>要在 App Engine 中运行,可以先在 UI 中创建一个项目,它设置唯一标识符并设置 HTTP 路由.向项目添加一个 Java 应用程序并将其留空,然后使用 Google Cloud SDK 从命令行或 CI build将 Spring Boot 应用程序推送到该插槽中.</p>
<p>App Engine Standard 要求使用 WAR 打包. 按照 <a target="_blank" rel="noopener" href="https://github.com/GoogleCloudPlatform/java-docs-samples/tree/master/appengine-java8/springboot-helloworld/README.md">these steps</a>将 App Engine 标准应用程序部署到 GCP.</p>
<p>或者,App Engine Flex 要求创建一个 <code>app.yaml</code> 文件来描述应用程序所需的资源.通常,将此文件放在 <code>src/main/appengine</code> 中,它应该类似于以下文件:</p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">service: defaultruntime: javaenv: flexruntime_config:  jdk: openjdk8handlers:- url:</span> <span class="string">/.*</span>  <span class="attr">script:</span> <span class="string">this</span> <span class="string">field</span> <span class="string">is</span> <span class="string">required,</span> <span class="attr">but ignoredmanual_scaling:  instances: 1health_check:  enable_health_check: Falseenv_variables:  ENCRYPT_KEY:</span> <span class="string">your_encryption_key_here</span></span><br></pre></td></tr></tbody></table></figure>

<p>可以通过添加项目 ID 到构建配置中来部署应用程序(例如,使用 Maven 插件),如以下示例所示:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span>    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.google.cloud.tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>appengine-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>        <span class="tag">&lt;<span class="name">project</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">project</span>&gt;</span>    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>然后使用 <code>mvn appengine:deploy</code> 进行部署(如果需要先进行身份验证,则构建失败).</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/15372.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/15372.html" class="post-title-link" itemprop="url">5.1 Deploy:  部署Spring Boot应用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:34:00 / 修改时间：13:03:15" itemprop="dateCreated datePublished" datetime="2021-06-10T12:34:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/15372.html" class="post-meta-item leancloud_visitors" data-flag-title="5.1 Deploy:  部署Spring Boot应用" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>824</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h5 id="部署Spring-Boot应用-Deploying-Spring-Boot-Applications"><a href="#部署Spring-Boot应用-Deploying-Spring-Boot-Applications" class="headerlink" title="部署Spring Boot应用(Deploying Spring Boot Applications)"></a>部署Spring Boot应用(Deploying Spring Boot Applications)</h5><p>Spring Boot 的灵活打包选项在部署应用时,提供了大量选择.可以将 Spring Boot 应用程序部署到各种云平台,容器映像( 例如 Docker)或虚拟/真实机器上.</p>
<p>本节介绍了一些更常见的部署方案.</p>
<ol>
<li><h5 id="部署到容器-Deploying-to-Containers"><a href="#部署到容器-Deploying-to-Containers" class="headerlink" title="部署到容器(Deploying to Containers)"></a>部署到容器(Deploying to Containers)</h5><p>如果从容器运行应用,则可以使用可执行 jar,但将其unexploded 并以不同方式运行它通常也是一个优势.某些 PaaS 实现也能在运行之前解压缩存档.例如,Cloud Foundry 就是这样运作的. 运行解压存档的一种方法是启动合适的启动器,如下所示:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jar -xf myapp.jar</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> java org.springframework.boot.loader.JarLauncher</span></span><br></pre></td></tr></tbody></table></figure>

<p>这实际上在启动时( 取决于 jar 的大小)比从未unexploded 的存档中运行要快一些. 在运行时,没有任何差异.</p>
<p>解压 jar 文件后,还可以通过使用其”自然”main 方法而不是 <code>JarLauncher</code> 运行应用程序来获得额外的启动时间. 例如:</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> jar -xf myapp.jar</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> java -cp BOOT-INF/classes:BOOT-INF/lib/* com.example.MyApplication</span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>注意:</p>
<p>​    在应用程序的 main 方法上使用 <code>JarLauncher</code> 具有其他好处:可以预测的类路径的顺序.jar 包含一个 <code>classpath.idx</code> 文件,<code>JarLauncher</code> 在构造类路径时使用该文件.</p>
</blockquote>
<p>可以通过[创建单独的层](<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/reference/html/features.html#features.container-images.building">https://docs.spring.io/spring-boot/docs/2.5.0/reference/html/features.html#features.container-images.building</a> .dockerfiles) 用于依赖项和应用程序类和资源( 通常更改更频繁)来更高效的容器镜像.</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/55274.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/55274.html" class="post-title-link" itemprop="url">4.10 Acuator: Cloud Foundry 支持</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:32:00 / 修改时间：13:04:30" itemprop="dateCreated datePublished" datetime="2021-06-10T12:32:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/55274.html" class="post-meta-item leancloud_visitors" data-flag-title="4.10 Acuator: Cloud Foundry 支持" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="10">
<li><h5 id="Cloud-Foundry-支持"><a href="#Cloud-Foundry-支持" class="headerlink" title="Cloud Foundry 支持"></a>Cloud Foundry 支持</h5><p>当部署 Cloud Foundry 实例时,将会激活的Spring Boot 的执行器模块所包含的其他的功能支持.  <code>/cloudfoundryapplication</code> 路径为所有<code>@Endpoint</code> bean 提供了一个可以替代的的安全路由. </p>
<p>扩展支持让 Cloud Foundry 管理 UI(例如可用于查看已部署应用程序的 Web 应用)使用 Spring Boot 执行器信息进行扩充.例如,应用状态页面可能包含完整的健康信息,而不是典型的”running”或”stopped”状态.</p>
<blockquote>
<p>注意:</p>
<p>​    普通用户无法直接访问 <code>/cloudfoundryapplication</code> 路径. 为了使用端点,有效的 UAA token 必须与请求一起传递.</p>
</blockquote>
<ol>
<li><h5 id="禁用扩展-Cloud-Foundry-执行器支持-Disabling-Extended-Cloud-Foundry-Actuator-Support"><a href="#禁用扩展-Cloud-Foundry-执行器支持-Disabling-Extended-Cloud-Foundry-Actuator-Support" class="headerlink" title="禁用扩展 Cloud Foundry 执行器支持(Disabling Extended Cloud Foundry Actuator Support)"></a>禁用扩展 Cloud Foundry 执行器支持(Disabling Extended Cloud Foundry Actuator Support)</h5><p>如果要完全禁用 <code>/cloudfoundryapplication</code> 端点,可以将以下设置添加到 <code>application.properties</code> 文件:</p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.cloudfoundry.enabled</span>=<span class="string">false</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="Cloud-Foundry-自签名证书-Cloud-Foundry-Self-signed-Certificates"><a href="#Cloud-Foundry-自签名证书-Cloud-Foundry-Self-signed-Certificates" class="headerlink" title="Cloud Foundry 自签名证书(Cloud Foundry Self-signed Certificates)"></a>Cloud Foundry 自签名证书(Cloud Foundry Self-signed Certificates)</h6><p>默认情况下,<code>/cloudfoundryapplication</code> 端点的安全验证会对各种 Cloud Foundry 服务进行 SSL 调用.如果 Cloud Foundry UAA 或 Cloud Controller 服务使用自签名证书,则需要设置以下属性:</p>
<figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">management.cloudfoundry.skip-ssl-validation</span>=<span class="string">true</span></span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="自定义上下文路径-Custom-Context-Path"><a href="#自定义上下文路径-Custom-Context-Path" class="headerlink" title="自定义上下文路径(Custom Context Path)"></a>自定义上下文路径(Custom Context Path)</h6><p>如果服务器的context-path已配置为 <code>/</code> 以外的任何内容,则 Cloud Foundry 端点在应用的根目录中将不可用.例如,如果 <code>server.servlet.context-path=/app</code>,则 Cloud Foundry 端点将在 <code>/app/cloudfoundryapplication/*</code> 处可用.</p>
<p>如果希望 Cloud Foundry 端点始终在 <code>/cloudfoundryapplication/*</code> 可用,无论服务器的上下文路径如何,都需要在应用中显式配置它.配置将因 Web 服务器而异. 对于Tomcat,可以添加如下配置:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCloudFoundryConfiguration</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TomcatServletWebServerFactory <span class="title">servletWebServerFactory</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TomcatServletWebServerFactory() {</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareContext</span><span class="params">(Host host, ServletContextInitializer[] initializers)</span> </span>{</span><br><span class="line">                <span class="keyword">super</span>.prepareContext(host, initializers);</span><br><span class="line">                StandardContext child = <span class="keyword">new</span> StandardContext();</span><br><span class="line">                child.addLifecycleListener(<span class="keyword">new</span> Tomcat.FixContextListener());</span><br><span class="line">                child.setPath(<span class="string">"/cloudfoundryapplication"</span>);</span><br><span class="line">                ServletContainerInitializer initializer = getServletContextInitializer(getContextPath());</span><br><span class="line">                child.addServletContainerInitializer(initializer, Collections.emptySet());</span><br><span class="line">                child.setCrossContext(<span class="keyword">true</span>);</span><br><span class="line">                host.addChild(child);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ServletContainerInitializer <span class="title">getServletContextInitializer</span><span class="params">(String contextPath)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> (classes, context) -&gt; {</span><br><span class="line">            Servlet servlet = <span class="keyword">new</span> GenericServlet() {</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>{</span><br><span class="line">                    ServletContext context = req.getServletContext().getContext(contextPath);</span><br><span class="line">                    context.getRequestDispatcher(<span class="string">"/cloudfoundryapplication"</span>).forward(req, res);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">            };</span><br><span class="line">            context.addServlet(<span class="string">"cloudfoundry"</span>, servlet).addMapping(<span class="string">"/*"</span>);</span><br><span class="line">        };</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/21505.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/21505.html" class="post-title-link" itemprop="url">4.9 Acuator: 进程监控</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:30:00 / 修改时间：13:05:02" itemprop="dateCreated datePublished" datetime="2021-06-10T12:30:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/21505.html" class="post-meta-item leancloud_visitors" data-flag-title="4.9 Acuator: 进程监控" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>664</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="9">
<li><h5 id="进程监控-Process-Monitoring"><a href="#进程监控-Process-Monitoring" class="headerlink" title="进程监控(Process Monitoring)"></a>进程监控(Process Monitoring)</h5><p>在 <code>spring-boot</code> 模块中,可以找到两个类来创建用于进程监控的文件:</p>
<ul>
<li><code>ApplicationPidFileWriter</code> 创建一个包含应用程序 PID 的文件(默认情况下,在应用程序目录中,文件名为”<code>application.pid</code>“).</li>
<li><code>WebServerPortFileWriter</code> 创建一个文件(或多个文件),其中包含正在运行的 Web 服务器的端口(默认情况下,在应用程序目录中,文件名为”<code>application.port</code>“).</li>
</ul>
<p>默认情况下,这些writers未激活,但可以启用:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/reference/html/actuator.html#actuator.process-monitoring.configuration">By Extending Configuration</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.5.0/reference/html/actuator.html#actuator.process-monitoring.programmatically">Programmatically</a></li>
</ul>
</li>
</ol>
<ol>
<li><h6 id="扩展配置-Extending-Configuration"><a href="#扩展配置-Extending-Configuration" class="headerlink" title="扩展配置(Extending Configuration)"></a>扩展配置(Extending Configuration)</h6><p>在 <code>META-INF/spring.factories</code> 文件中,可以启用写入 PID 文件的监听器,如下例所示:</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.ApplicationListener=\</span><br><span class="line">org.springframework.boot.context.ApplicationPidFileWriter,\</span><br><span class="line">org.springframework.boot.web.context.WebServerPortFileWriter</span><br></pre></td></tr></tbody></table></figure></li>
<li><h6 id="编程方式实现-Programmatically"><a href="#编程方式实现-Programmatically" class="headerlink" title="编程方式实现(Programmatically)"></a>编程方式实现(Programmatically)</h6><p>还可以通过调用 <code>SpringApplication.addListeners(… ) </code>方法并传递适当的 <code>Writer</code> 对象来激活监听器.此方法还允许在 <code>Writer</code> 构造函数中自定义文件名和路径.</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/64760.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/64760.html" class="post-title-link" itemprop="url">4.8 Acuator:  HTTP 追踪</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:27:00 / 修改时间：13:08:00" itemprop="dateCreated datePublished" datetime="2021-06-10T12:27:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/64760.html" class="post-meta-item leancloud_visitors" data-flag-title="4.8 Acuator:  HTTP 追踪" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>455</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="8">
<li><h5 id="HTTP-追踪-HTTP-Tracing"><a href="#HTTP-追踪-HTTP-Tracing" class="headerlink" title="HTTP 追踪(HTTP Tracing)"></a>HTTP 追踪(HTTP Tracing)</h5><p>可以在应用的配置中提供类型为 <code>HttpTraceRepository</code> 的 bean 来启用 HTTP 跟踪.为方便起见,默认情况下,Spring Boot 提供了一个 <code>InMemoryHttpTraceRepository</code>,用于存储最近 100 个请求-响应交换的跟踪.<code>InMemoryHttpTraceRepository</code> 与其他跟踪解决方案相比功能有限,建议仅将其用于开发环境.对于生产环境,建议使用生产就绪的跟踪或可观察性解决方案,例如 Zipkin 或 Spring Cloud Sleuth.或者,创建自己的 <code>HttpTraceRepository</code> 以满足需求.</p>
<p><code>httptrace</code> 端点可用于获取存储在 <code>HttpTraceRepository</code> 中的有关请求-响应交换的信息.</p>
<ol>
<li><h6 id="自定义-HTTP-跟踪-Custom-HTTP-tracing"><a href="#自定义-HTTP-跟踪-Custom-HTTP-tracing" class="headerlink" title="自定义 HTTP 跟踪(Custom HTTP tracing)"></a>自定义 HTTP 跟踪(Custom HTTP tracing)</h6><p>要自定义每个跟踪中包含的项目,请使用 <code>management.trace.http.include</code> 配置属性.对于高级自定义,考虑注册自己的 <code>HttpExchangeTracer</code> 实现.</p>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope="" itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/posts/24567.html">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="chenyk">
      <meta itemprop="description" content="">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ykproton">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/24567.html" class="post-title-link" itemprop="url">4.7 Acuator: 审计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-06-10 12:25:00 / 修改时间：13:05:50" itemprop="dateCreated datePublished" datetime="2021-06-10T12:25:00+08:00">2021-06-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
          <a href="/categories/Spring-Boot/" itemprop="url" rel="index"><span itemprop="name">Spring Boot</span></a>
        </span>
    </span>

  
    <span id="/posts/24567.html" class="post-meta-item leancloud_visitors" data-flag-title="4.7 Acuator: 审计" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>598</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 ≈</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol start="7">
<li><h5 id="审计-Auditing"><a href="#审计-Auditing" class="headerlink" title="审计(Auditing)"></a>审计(Auditing)</h5><p>一旦 Spring Security 发挥作用,Spring Boot Actuator 就有一个灵活的审计框架来发布事件( 默认情况下,”authentication success”,”failure”和”access denied”异常).此功能对于报告和实施基于身份验证失败的锁定策略非常有用.</p>
<p>可以通过在应用配置中提供类型为 <code>AuditEventRepository</code> 的 bean 来启用审计.为方便起见,Spring Boot 提供了一个 <code>InMemoryAuditEventRepository</code>.<code>InMemoryAuditEventRepository</code> 的功能有限,建议仅将其用于开发环境.对于生产环境,请考虑创建自己的替代 <code>AuditEventRepository</code> 实现.</p>
<ol>
<li><h6 id="Custom-Auditing"><a href="#Custom-Auditing" class="headerlink" title="Custom Auditing"></a>Custom Auditing</h6><p>要自定义发布的安全事件,可以提供自己的 <code>AbstractAuthenticationAuditListener</code> 和 <code>AbstractAuthorizationAuditListener</code> 实现.</p>
<p>还可以将审计服务用于自己的业务事件.为此,请将 <code>AuditEventRepository</code> bean 注入自己的组件并直接使用它,或者使用 Spring <code>ApplicationEventPublisher</code>( 通过实现 <code>ApplicationEventPublisherAware</code>)发布 <code>AuditApplicationEvent</code>.</p>
</li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">…</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  © 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">chenyk</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">305k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:37</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>


  





  
  

  
  <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  
  


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.1.0/dist/quicklink.umd.js"></script>
  
  



<script src="/bundle.js"></script><script>{&quot;enable&quot;:true,&quot;spinner&quot;:true};
{&quot;enable&quot;:true,&quot;app_id&quot;:null,&quot;app_key&quot;:null,&quot;server_url&quot;:null,&quot;security&quot;:true};
{&quot;enable&quot;:true,&quot;home&quot;:true,&quot;archive&quot;:true,&quot;delay&quot;:true,&quot;timeout&quot;:3000,&quot;priority&quot;:true,&quot;ignores&quot;:null,&quot;url&quot;:&quot;http:&#x2F;&#x2F;example.com&#x2F;&quot;}</script></body></html>